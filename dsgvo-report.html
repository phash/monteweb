<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DSGVO-Prüfbericht – MonteWeb Schul-Intranet</title>
  <style>
    :root {
      --color-kritisch: #c0392b;
      --color-kritisch-bg: #fdf0ef;
      --color-hoch: #e67e22;
      --color-hoch-bg: #fef9f0;
      --color-mittel: #f39c12;
      --color-mittel-bg: #fefdf0;
      --color-niedrig: #27ae60;
      --color-niedrig-bg: #f0fef5;
      --color-positiv: #2980b9;
      --color-positiv-bg: #f0f8ff;
      --color-behoben: #16a085;
      --color-behoben-bg: #e8f8f5;
      --color-header: #1a2942;
      --color-text: #2c3e50;
      --color-border: #dee2e6;
      --color-code: #f8f9fa;
      --font-main: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      --font-mono: 'Courier New', Courier, monospace;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: var(--font-main);
      color: var(--color-text);
      background: #f5f6f8;
      line-height: 1.6;
    }

    .page-header {
      background: var(--color-header);
      color: #fff;
      padding: 40px 60px;
    }

    .page-header h1 {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .page-header .subtitle {
      font-size: 1rem;
      opacity: 0.75;
    }

    .meta-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 12px;
      margin-top: 24px;
    }

    .meta-item {
      background: rgba(255,255,255,0.1);
      border-radius: 6px;
      padding: 12px 16px;
    }

    .meta-item .label { font-size: 0.75rem; opacity: 0.7; text-transform: uppercase; letter-spacing: 0.5px; }
    .meta-item .value { font-size: 1rem; font-weight: 600; margin-top: 4px; }

    .container {
      max-width: 1100px;
      margin: 0 auto;
      padding: 32px 24px;
    }

    .summary-box {
      background: #fff;
      border-radius: 10px;
      padding: 28px 32px;
      margin-bottom: 28px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.07);
      border-left: 5px solid var(--color-mittel);
    }

    .summary-box h2 { font-size: 1.3rem; margin-bottom: 16px; color: var(--color-header); }

    .rating-badge {
      display: inline-block;
      padding: 6px 18px;
      border-radius: 20px;
      font-weight: 700;
      font-size: 0.95rem;
      margin-bottom: 16px;
    }

    .rating-teilweise { background: #fff3cd; color: #856404; border: 1px solid #ffc107; }
    .rating-konform { background: #d4edda; color: #155724; border: 1px solid #28a745; }

    .counter-row {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      margin-top: 16px;
    }

    .counter {
      border-radius: 8px;
      padding: 10px 20px;
      font-weight: 700;
      font-size: 0.9rem;
      min-width: 120px;
      text-align: center;
    }

    .counter-k { background: var(--color-kritisch-bg); color: var(--color-kritisch); border: 1px solid var(--color-kritisch); }
    .counter-h { background: var(--color-hoch-bg); color: var(--color-hoch); border: 1px solid var(--color-hoch); }
    .counter-m { background: var(--color-mittel-bg); color: var(--color-mittel); border: 1px solid var(--color-mittel); }
    .counter-n { background: var(--color-niedrig-bg); color: var(--color-niedrig); border: 1px solid var(--color-niedrig); }
    .counter-b { background: var(--color-behoben-bg); color: var(--color-behoben); border: 1px solid var(--color-behoben); }

    .section-title {
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--color-header);
      margin: 32px 0 16px;
      padding-bottom: 8px;
      border-bottom: 2px solid var(--color-border);
    }

    .finding {
      background: #fff;
      border-radius: 10px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      overflow: hidden;
    }

    .finding-header {
      padding: 14px 20px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .finding-header.kritisch { background: var(--color-kritisch-bg); border-left: 5px solid var(--color-kritisch); }
    .finding-header.hoch     { background: var(--color-hoch-bg);     border-left: 5px solid var(--color-hoch); }
    .finding-header.mittel   { background: var(--color-mittel-bg);   border-left: 5px solid var(--color-mittel); }
    .finding-header.niedrig  { background: var(--color-niedrig-bg);  border-left: 5px solid var(--color-niedrig); }
    .finding-header.behoben  { background: var(--color-behoben-bg);  border-left: 5px solid var(--color-behoben); }

    .finding-id {
      font-size: 0.75rem;
      font-weight: 700;
      color: #666;
      white-space: nowrap;
    }

    .finding-title {
      font-weight: 600;
      font-size: 0.95rem;
      flex: 1;
    }

    .finding-badge {
      font-size: 0.72rem;
      font-weight: 700;
      padding: 3px 10px;
      border-radius: 12px;
      white-space: nowrap;
    }

    .badge-kritisch { background: var(--color-kritisch); color: #fff; }
    .badge-hoch     { background: var(--color-hoch);     color: #fff; }
    .badge-mittel   { background: var(--color-mittel);   color: #fff; }
    .badge-niedrig  { background: var(--color-niedrig);  color: #fff; }
    .badge-behoben  { background: var(--color-behoben);  color: #fff; }

    .finding-body {
      padding: 18px 24px;
      border-top: 1px solid var(--color-border);
    }

    .finding-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
      margin-bottom: 14px;
    }

    @media (max-width: 700px) {
      .finding-grid { grid-template-columns: 1fr; }
    }

    .field-label {
      font-size: 0.72rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: #888;
      margin-bottom: 4px;
    }

    .field-value {
      font-size: 0.88rem;
      color: var(--color-text);
    }

    code {
      background: var(--color-code);
      border: 1px solid var(--color-border);
      border-radius: 4px;
      padding: 1px 5px;
      font-family: var(--font-mono);
      font-size: 0.82rem;
    }

    pre {
      background: var(--color-code);
      border: 1px solid var(--color-border);
      border-radius: 6px;
      padding: 12px;
      overflow-x: auto;
      font-family: var(--font-mono);
      font-size: 0.82rem;
      margin-top: 6px;
    }

    .recommendation-box {
      background: #f0f8ff;
      border: 1px solid #b3d7f0;
      border-radius: 6px;
      padding: 12px 16px;
      margin-top: 10px;
    }

    .recommendation-box .rec-label {
      font-size: 0.72rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: #2980b9;
      margin-bottom: 6px;
    }

    .recommendation-box p, .recommendation-box li {
      font-size: 0.88rem;
    }

    .recommendation-box ul { margin-left: 18px; margin-top: 4px; }

    .fix-box {
      background: var(--color-behoben-bg);
      border: 1px solid var(--color-behoben);
      border-radius: 6px;
      padding: 12px 16px;
      margin-top: 10px;
    }

    .fix-box .fix-label {
      font-size: 0.72rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--color-behoben);
      margin-bottom: 6px;
    }

    .fix-box p, .fix-box li { font-size: 0.88rem; }
    .fix-box ul { margin-left: 18px; margin-top: 4px; }

    .positive-box {
      background: #fff;
      border-radius: 10px;
      padding: 20px 24px;
      margin-bottom: 14px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      border-left: 5px solid var(--color-positiv);
    }

    .positive-box h4 {
      font-size: 0.95rem;
      font-weight: 700;
      color: var(--color-positiv);
      margin-bottom: 6px;
    }

    .positive-box p, .positive-box li { font-size: 0.88rem; }
    .positive-box ul { margin-left: 18px; margin-top: 4px; }

    .action-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.88rem;
      background: #fff;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    }

    .action-table th {
      background: var(--color-header);
      color: #fff;
      padding: 12px 16px;
      text-align: left;
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .action-table td {
      padding: 10px 16px;
      border-bottom: 1px solid var(--color-border);
      vertical-align: top;
    }

    .action-table tr:last-child td { border-bottom: none; }
    .action-table tr:nth-child(even) td { background: #f9fafb; }

    .priority-k { color: var(--color-kritisch); font-weight: 700; }
    .priority-h { color: var(--color-hoch); font-weight: 700; }
    .priority-m { color: var(--color-mittel); font-weight: 700; }
    .priority-b { color: var(--color-behoben); font-weight: 700; }

    .doc-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 14px;
      margin-top: 8px;
    }

    .doc-card {
      background: #fff;
      border-radius: 8px;
      padding: 16px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.07);
      border-top: 3px solid var(--color-hoch);
    }

    .doc-card h4 { font-size: 0.9rem; color: var(--color-header); margin-bottom: 6px; }
    .doc-card p { font-size: 0.82rem; color: #666; }

    .toc {
      background: #fff;
      border-radius: 10px;
      padding: 20px 24px;
      margin-bottom: 28px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    }

    .toc h3 { font-size: 1rem; margin-bottom: 12px; color: var(--color-header); }
    .toc ol { margin-left: 20px; }
    .toc li { font-size: 0.88rem; margin-bottom: 6px; }
    .toc a { color: var(--color-positiv); text-decoration: none; }
    .toc a:hover { text-decoration: underline; }

    .article-ref {
      display: inline-block;
      background: #e8f4f8;
      color: #1a6a8a;
      border: 1px solid #b3d7e8;
      border-radius: 4px;
      padding: 1px 8px;
      font-size: 0.78rem;
      font-weight: 600;
      margin-right: 4px;
    }

    .changelog-box {
      background: #fff;
      border-radius: 10px;
      padding: 20px 24px;
      margin-bottom: 28px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      border-left: 5px solid var(--color-behoben);
    }

    .changelog-box h3 { font-size: 1.05rem; color: var(--color-behoben); margin-bottom: 12px; }
    .changelog-box ul { margin-left: 20px; }
    .changelog-box li { font-size: 0.88rem; margin-bottom: 6px; }

    footer {
      text-align: center;
      color: #aaa;
      font-size: 0.8rem;
      padding: 24px;
      border-top: 1px solid var(--color-border);
      margin-top: 40px;
    }
  </style>
</head>
<body>

<div class="page-header">
  <h1>DSGVO-Prüfbericht</h1>
  <div class="subtitle">MonteWeb – Selbst-gehostetes Schul-Intranet für Montessori-Schulen | Nachaudit nach Fixes</div>
  <div class="meta-grid">
    <div class="meta-item">
      <div class="label">Prüfdatum</div>
      <div class="value">01.03.2026</div>
    </div>
    <div class="meta-item">
      <div class="label">Prüfer</div>
      <div class="value">Datenschutzbeauftragter (KI-gestützt)</div>
    </div>
    <div class="meta-item">
      <div class="label">Verzeichnis</div>
      <div class="value">E:\claude\montessori</div>
    </div>
    <div class="meta-item">
      <div class="label">Stack</div>
      <div class="value">Spring Boot 3.4 / Vue 3 / PostgreSQL 16</div>
    </div>
    <div class="meta-item">
      <div class="label">Git-Stand</div>
      <div class="value">main (nach Commit 7798f05)</div>
    </div>
    <div class="meta-item">
      <div class="label">Gesamturteil</div>
      <div class="value">TEILWEISE KONFORM</div>
    </div>
  </div>
</div>

<div class="container">

  <div class="toc">
    <h3>Inhaltsverzeichnis</h3>
    <ol>
      <li><a href="#changelog">Behobene Findings seit letztem Audit (Commit 7798f05)</a></li>
      <li><a href="#zusammenfassung">Zusammenfassung und Executive Summary</a></li>
      <li><a href="#kritisch">Kritische Findings (sofortiger Handlungsbedarf)</a></li>
      <li><a href="#hoch">Hohe Risiken</a></li>
      <li><a href="#mittel">Mittlere Risiken</a></li>
      <li><a href="#niedrig">Niedrige Risiken und Hinweise</a></li>
      <li><a href="#positiv">Positive Befunde (bereits gut umgesetzt)</a></li>
      <li><a href="#massnahmen">Priorisierter Maßnahmenplan</a></li>
      <li><a href="#dokumentation">Erforderliche Dokumentation</a></li>
    </ol>
  </div>

  <!-- CHANGELOG: BEHOBENE FINDINGS -->
  <div class="changelog-box" id="changelog">
    <h3>Behobene Findings seit letztem Audit (Commit 7798f05)</h3>
    <ul>
      <li><strong>F-001 (BEHOBEN):</strong> JWT-Tokens aus localStorage entfernt. Access-Token nur noch im Pinia-Store (<code>ref()</code>), Refresh-Token in <code>sessionStorage</code>. Verbleibende Restgefahr: sessionStorage ist bei XSS weiterhin lesbar (siehe F-001-REST unten), aber erheblich besser als localStorage (kein persistenter Speicher, kein Zugriff durch andere Tabs).</li>
      <li><strong>F-002 (BEHOBEN):</strong> <code>useErrorReporting.ts</code> sendet nun nur noch <code>window.location.pathname</code> (kein <code>userAgent</code>, kein Query-String, kein Fragment). Datensparsamkeitsprinzip (Art. 5 Abs. 1 lit. c) jetzt eingehalten.</li>
      <li><strong>F-004 (BEHOBEN):</strong> <code>PrivacyController.updateConsent()</code> prüft STUDENT-Rolle und blockiert Selbst-Consent mit HTTP 403. Schülerinnen und Schüler können ihre Einwilligung nicht selbst setzen; Elternteil oder Erziehungsberechtigte müssen handeln.</li>
      <li><strong>F-006 (BEHOBEN):</strong> <code>AesEncryptionService</code> nutzt jetzt <code>${monteweb.encryption.secret}</code> als primäre Quelle (eigenes Secret, unabhängig von JWT_SECRET). Fallback auf JWT_SECRET mit Warn-Log wenn ENCRYPTION_SECRET fehlt. <code>SecretValidationConfig</code> prüft ENCRYPTION_SECRET auf Mindestlänge (64 Zeichen) und Differenz zum JWT_SECRET.</li>
      <li><strong>F-008 (BEHOBEN):</strong> <code>RetentionCleanupService</code> löscht jetzt tatsächlich alte Notifications via <code>notificationModuleApi.deleteOlderThan()</code> und bereinigt außerdem alte Error-Reports nach konfigurierbaren Fristen (90 Tage RESOLVED/IGNORED, 365 Tage NEW/REPORTED).</li>
    </ul>
  </div>

  <!-- EXECUTIVE SUMMARY -->
  <div class="summary-box" id="zusammenfassung">
    <h2>Executive Summary</h2>
    <div class="rating-badge rating-teilweise">TEILWEISE KONFORM</div>
    <p>MonteWeb ist ein selbst-gehostetes Schul-Intranet für Montessori-Schulen und verarbeitet personenbezogene Daten von Kindern, Eltern und Lehrkräften. Im Nachaudit nach Commit 7798f05 wurden 5 der zuvor identifizierten Findings verifiziert behoben. Dies ist ein erheblicher Fortschritt: Das XSS-Risiko durch localStorage-Tokens ist deutlich reduziert, die PII-Übermittlung im Error-Reporting ist minimiert, der STUDENT-Selbst-Consent ist blockiert, der AES-Encryption-Key ist vom JWT-Secret entkoppelt, und der Notification-Retention-Cleanup ist funktional.</p>
    <p style="margin-top: 10px;">Dennoch verbleiben 3 kritische, 4 hohe und 6 mittlere Findings. Besonders kritisch: (1) Das Verzeichnis der Verarbeitungstätigkeiten (Art. 30) fehlt vollständig, (2) die Datenschutz-Folgenabschätzung (Art. 35) für Kinderdaten ist nicht durchgeführt, (3) TOTP-Secrets liegen als Klartext in der Datenbank. Neu identifiziert wurde zudem ein residuales Risiko bei der sessionStorage-Speicherung von Refresh-Tokens.</p>
    <div class="counter-row">
      <div class="counter counter-k">1 Kritisch (offen)</div>
      <div class="counter counter-h">4 Hoch (offen)</div>
      <div class="counter counter-m">6 Mittel (offen)</div>
      <div class="counter counter-n">3 Hinweise</div>
      <div class="counter counter-b">5 Behoben</div>
    </div>
    <p style="margin-top: 16px; font-size: 0.88rem; color: #666;">
      <strong>Prüfungsumfang:</strong> Frontend-Stores (<code>auth.ts</code>), Composables (<code>useErrorReporting.ts</code>), Backend-Module: Auth (SecurityConfig, AuthService, TotpService, RefreshTokenService), User (PrivacyController, UserController, User.java, RetentionCleanupService), Admin (TenantConfig, AesEncryptionService, AdminService), Shared (SecretValidationConfig, GlobalExceptionHandler, RateLimitFilter, ClamAvService), Files (WopiController, WopiTokenService), Fotobox (FotoboxImage, FotoboxDeletionListener), Search (SearchDeletionListener), application.yml, Flyway V001–V099.
    </p>
  </div>

  <!-- KRITISCHE FINDINGS -->
  <div class="section-title" id="kritisch">Kritische Findings – Sofortiger Handlungsbedarf</div>

  <div class="finding">
    <div class="finding-header kritisch">
      <span class="finding-id">F-003</span>
      <span class="finding-title">Kein Verzeichnis der Verarbeitungstätigkeiten (Art. 30 DSGVO) – organisatorische Pflichtdokumentation fehlt vollständig</span>
      <span class="finding-badge badge-kritisch">KRITISCH | OFFEN</span>
    </div>
    <div class="finding-body">
      <div class="finding-grid">
        <div>
          <div class="field-label">DSGVO-Artikel</div>
          <div class="field-value">
            <span class="article-ref">Art. 30 DSGVO</span>
            <span class="article-ref">Art. 83 Abs. 4 lit. a</span>
          </div>
        </div>
        <div>
          <div class="field-label">Fundstelle</div>
          <div class="field-value">Organisatorisch (kein Code-Bezug); betrifft alle Module des Systems</div>
        </div>
      </div>
      <div class="field-label">Beschreibung</div>
      <div class="field-value" style="margin-bottom: 12px;">
        Art. 30 DSGVO verpflichtet den Verantwortlichen zur Führung eines Verzeichnisses aller Verarbeitungstätigkeiten. Dieses Verzeichnis muss Angaben zu Zweck, Rechtsgrundlage, Datenkategorien, Empfängerkreis, Speicherfristen und Sicherheitsmaßnahmen für jede Verarbeitungstätigkeit enthalten. Eine Schule, die ein vollständiges Schul-Intranet mit Nachrichten, Fotoverarbeitung von Minderjährigen, Gesundheitsdaten-nahen Informationen und Familienstrukturen betreibt, hat bei weitem mehr als 250 Mitarbeiter-relevante Verarbeitungen oder verarbeitet besonders schutzbedürftige Daten (Minderjährige, Art. 9-nahe Gesundheitsdaten), sodass die Ausnahme des Art. 30 Abs. 5 nicht greift.
        <br><br>
        MonteWeb implementiert folgende datenschutzrechtlich relevante Verarbeitungstätigkeiten, die alle im VVT dokumentiert werden müssen:
        <ul style="margin-left: 18px; margin-top: 8px; font-size: 0.88rem;">
          <li>Nutzerverwaltung (User-Modul): Name, E-Mail, Telefon, Rolle, Aktivitätsdaten</li>
          <li>Authentifizierung und Sitzungsverwaltung (Auth-Modul): Login-Logs, Token-Verwaltung, 2FA-Secrets</li>
          <li>Kommunikation (Messaging-Modul): Direktnachrichten zwischen Eltern/Lehrern/Schülern</li>
          <li>Fotobox (Fotobox-Modul): Fotos von Minderjährigen, Einwilligungserfordernis</li>
          <li>Familienverwaltung (Family-Modul): Familienzuordnung, Sorgerechtsangaben (ab V099: sole_custody)</li>
          <li>Stundenkonto/Jobboard: Arbeitsleistung und Stundennachweise der Eltern</li>
          <li>Fehler-Reporting (Admin-Modul): technische Fehlerberichte mit URL-Pfaden</li>
          <li>Audit-Log (data_access_log): Protokollierung aller Datenzugriffe</li>
          <li>Push-Benachrichtigungen: Gerätekennungen (VAPID)</li>
          <li>LDAP-Integration (wenn aktiviert): Authentifizierung gegen Active Directory</li>
          <li>Suchindex (Solr): Volltext-Indexierung personenbezogener Inhalte</li>
          <li>Kalender-Abonnements (iCal): Import externer Kalender</li>
        </ul>
      </div>
      <div class="field-label">Risiko</div>
      <div class="field-value" style="margin-bottom: 10px;">
        Fehlendes VVT ist ein unmittelbarer Verstoß gegen Art. 30 DSGVO. Bußgeld bis 10 Mio. EUR oder 2 % des weltweiten Jahresumsatzes (Art. 83 Abs. 4). Bei Kontrolle durch die Aufsichtsbehörde muss das VVT unverzüglich vorgelegt werden können.
      </div>
      <div class="recommendation-box">
        <div class="rec-label">Empfehlung</div>
        <ul>
          <li>Erstellen eines VVT-Dokuments (Tabelle oder System) mit einer Zeile pro Verarbeitungstätigkeit.</li>
          <li>Pflichtangaben je Eintrag: Name der Verarbeitung, Zweck, Rechtsgrundlage (Art. 6 Abs. 1 + ggf. Art. 9 Abs. 2), betroffene Personengruppen, Datenkategorien, Empfänger, Drittlandübermittlung, Löschfristen, technische und organisatorische Maßnahmen (TOMs).</li>
          <li>VVT mindestens jährlich überprüfen und bei Systemänderungen aktualisieren.</li>
          <li>Zuordnung: Verantwortlicher ist der Schul-Träger, nicht der Software-Entwickler. Die Schule muss das VVT führen.</li>
          <li>Vorlage: Orientierung an BITKOM-Muster-VVT oder BayLDA-Vorlage für Schulen.</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- HOHE RISIKEN -->
  <div class="section-title" id="hoch">Hohe Risiken</div>

  <div class="finding">
    <div class="finding-header hoch">
      <span class="finding-id">F-001-REST</span>
      <span class="finding-title">Residuales XSS-Risiko: Refresh-Token in sessionStorage (Sitzungsübernahme via XSS im gleichen Tab)</span>
      <span class="finding-badge badge-hoch">HOCH | OFFEN</span>
    </div>
    <div class="finding-body">
      <div class="finding-grid">
        <div>
          <div class="field-label">DSGVO-Artikel</div>
          <div class="field-value">
            <span class="article-ref">Art. 32 DSGVO</span>
            <span class="article-ref">Art. 5 Abs. 1 lit. f</span>
          </div>
        </div>
        <div>
          <div class="field-label">Fundstelle</div>
          <div class="field-value"><code>frontend/src/stores/auth.ts</code>, Funktion <code>setTokens()</code> Zeilen 142–146</div>
        </div>
      </div>
      <div class="field-label">Beschreibung</div>
      <div class="field-value" style="margin-bottom: 12px;">
        Der Wechsel von localStorage zu sessionStorage für JWT-Tokens (Fix F-001) ist ein bedeutender Fortschritt: sessionStorage ist nicht persistent, nicht durch andere Tabs zugänglich und wird beim Schliessen des Browsers geleert. Dennoch ist sessionStorage durch JavaScript im gleichen Tab vollständig lesbar.
        <pre>// frontend/src/stores/auth.ts (aktueller Stand nach Fix)
function setTokens(access: string, refresh: string) {
  accessToken.value = access
  sessionStorage.setItem('accessToken', access)   // via JS lesbar im gleichen Tab
  sessionStorage.setItem('refreshToken', refresh) // via JS lesbar im gleichen Tab
}</pre>
        Ein XSS-Angriff, der im aktiven Tab der Applikation ausgeführt wird (z. B. durch ein kompromittiertes npm-Paket oder eine DOM-basierte XSS), kann weiterhin den Refresh-Token auslesen und damit neue Access-Tokens generieren, solange der Refresh-Token nicht abläuft (konfiguriert: 7 Tage). Der Access-Token selbst liegt zwar nur im Pinia-Store-Memory (<code>ref()</code>), ist aber ebenfalls im laufenden JavaScript-Kontext zugänglich.
        <br><br>
        Das vollständige OWASP-empfohlene Schutzziel "Tokens unzugänglich für JavaScript" ist noch nicht erreicht.
      </div>
      <div class="field-label">Risiko</div>
      <div class="field-value" style="margin-bottom: 10px;">
        Geringer als localStorage (kein persistenter Speicher, kein Tab-übergreifender Zugriff), aber: Kompromittiertes npm-Paket oder DOM-XSS im gleichen Tab ermöglicht Sitzungsübernahme für bis zu 7 Tage. Betroffen: alle aktiven Nutzersitzungen, einschliesslich Kinderdaten.
      </div>
      <div class="recommendation-box">
        <div class="rec-label">Empfehlung (finale Absicherung)</div>
        <ul>
          <li><strong>Refresh-Token als HttpOnly-Cookie:</strong> Backend sendet Refresh-Token als <code>Set-Cookie: refresh_token=...; HttpOnly; Secure; SameSite=Strict; Path=/api/v1/auth/refresh</code>. Refresh-Token verlässt damit den JavaScript-Kontext vollständig.</li>
          <li><strong>Access-Token nur im Memory:</strong> Nur im Pinia-<code>ref()</code> (bereits umgesetzt). Bei Seitenreload: stiller <code>POST /api/v1/auth/refresh</code> aus dem HttpOnly-Cookie.</li>
          <li><strong>CSRF-Schutz für Refresh-Endpoint:</strong> SameSite=Strict verhindert Cross-Site-CSRF. Alternativ Double-Submit-Cookie-Pattern für erhöhte Sicherheit.</li>
          <li><strong>sessionStorage-Keys bereinigen:</strong> Bestehende <code>sessionStorage.setItem('accessToken', ...)</code>-Aufrufe vollständig entfernen.</li>
          <li>Diese Maßnahme eliminiert auch das Risiko, dass Server-Side-Rendering oder PWA-Cache-Probleme Tokens leaken.</li>
        </ul>
      </div>
    </div>
  </div>

  <div class="finding">
    <div class="finding-header hoch">
      <span class="finding-id">F-004-REST</span>
      <span class="finding-title">STUDENT-Selbst-Consent blockiert, aber parentale Einwilligung technisch nicht verifiziert (Art. 8 DSGVO)</span>
      <span class="finding-badge badge-hoch">HOCH | OFFEN</span>
    </div>
    <div class="finding-body">
      <div class="finding-grid">
        <div>
          <div class="field-label">DSGVO-Artikel</div>
          <div class="field-value">
            <span class="article-ref">Art. 8 DSGVO</span>
            <span class="article-ref">Art. 6 Abs. 1 lit. a</span>
            <span class="article-ref">ErwGr. 38</span>
          </div>
        </div>
        <div>
          <div class="field-label">Fundstelle</div>
          <div class="field-value">
            <code>user/internal/controller/PrivacyController.java</code>, Methode <code>updateConsent()</code>, Zeilen 136–144<br>
            Tabelle <code>consent_records</code>, Feld <code>granted_by</code>
          </div>
        </div>
      </div>
      <div class="field-label">Beschreibung</div>
      <div class="field-value" style="margin-bottom: 12px;">
        Der Fix in Commit 7798f05 blockiert korrekt, dass ein STUDENT seinen eigenen Consent setzt (<code>targetUserId.equals(userId)</code> + STUDENT-Rolle = HTTP 403). Dies ist eine wesentliche Verbesserung.
        <br><br>
        Das verbleibende Problem: Wenn <code>targetUserId</code> von <code>userId</code> abweicht (d. h. ein Elternteil setzt Consent für ein Kind), prüft der Controller nicht, ob der eingeloggte Nutzer tatsächlich dem Familienverbund des Kindes angehört:
        <pre>// PrivacyController.java Zeilen 127-128
UUID targetUserId = body.containsKey("targetUserId")
        ? UUID.fromString((String) body.get("targetUserId")) : userId;

// Keine Prüfung: Ist der eingeloggte User der Elternteil von targetUserId?</pre>
        Ein eingeloggter PARENT könnte theoretisch eine fremde User-UUID als <code>targetUserId</code> senden und damit für beliebige andere Nutzer (einschliesslich anderer Kinder) Einwilligungen setzen oder widerrufen. Dies stellt einen Autorisierungsbypass in der Consent-Verwaltung dar.
      </div>
      <div class="field-label">Risiko</div>
      <div class="field-value" style="margin-bottom: 10px;">
        Ein authentifizierter PARENT kann Foto-Einwilligungen für fremde Kinder setzen oder widerrufen. Dies unterläuft den Zweck des Art. 8 DSGVO (Schutz der Minderjährigen durch Eltern-Autorisierung) und kann zu unberechtigten Foto-Veröffentlichungen führen.
      </div>
      <div class="recommendation-box">
        <div class="rec-label">Empfehlung</div>
        <ul>
          <li>In <code>updateConsent()</code>: Wenn <code>targetUserId != userId</code>, Family-API prüfen ob der eingeloggte Nutzer und <code>targetUserId</code> dem gleichen Familienverbund angehören (<code>familyModuleApi.areInSameFamily(userId, targetUserId)</code>).</li>
          <li>Alternativ: SUPERADMIN erhält explizit Ausnahme-Berechtigung (Admin-Consent-Management).</li>
          <li>Validierung: <code>targetUserId</code> muss ein STUDENT-Account sein (keine Teacher, keine anderen Parents).</li>
          <li>Logging: Jede Consent-Änderung durch Dritte in <code>data_access_log</code> protokollieren (für Art. 15 DSGVO-Auskunft).</li>
        </ul>
      </div>
    </div>
  </div>

  <div class="finding">
    <div class="finding-header hoch">
      <span class="finding-id">F-005</span>
      <span class="finding-title">Keine Datenschutz-Folgenabschätzung (DSFA) für Hochrisikoverarbeitungen (Kinderdaten, Fotobox, Kommunikation)</span>
      <span class="finding-badge badge-hoch">HOCH | OFFEN</span>
    </div>
    <div class="finding-body">
      <div class="finding-grid">
        <div>
          <div class="field-label">DSGVO-Artikel</div>
          <div class="field-value">
            <span class="article-ref">Art. 35 DSGVO</span>
            <span class="article-ref">Art. 35 Abs. 3 lit. b</span>
            <span class="article-ref">ErwGr. 75</span>
          </div>
        </div>
        <div>
          <div class="field-label">Fundstelle</div>
          <div class="field-value">Organisatorisch; betrifft Module: fotobox, messaging, user (Kinderdaten), family</div>
        </div>
      </div>
      <div class="field-label">Beschreibung</div>
      <div class="field-value" style="margin-bottom: 12px;">
        Art. 35 Abs. 1 DSGVO fordert eine DSFA, wenn eine Verarbeitung "voraussichtlich ein hohes Risiko" birgt. Art. 35 Abs. 3 lit. b nennt explizit die umfangreiche Verarbeitung besonderer Kategorien oder Daten von Minderjährigen. Folgende Verarbeitungen in MonteWeb erfüllen dieses Kriterium:
        <ul style="margin-left: 18px; margin-top: 8px; font-size: 0.88rem;">
          <li><strong>Fotobox:</strong> Systematische Speicherung von Fotos Minderjähriger (Gesichtserkennung-Potenzial, Persönlichkeitsrecht)</li>
          <li><strong>Nachrichten-Modul:</strong> Kommunikation zwischen Minderjährigen und Erwachsenen (inkl. Missbrauchsrisiko)</li>
          <li><strong>Familienverwaltung (ab V099):</strong> Sorgerechts-Informationen (<code>sole_custody</code>-Feld) – hochsensibel</li>
          <li><strong>Solr-Volltextindex:</strong> Durchsuchbarkeit personenbezogener Inhalte aller Nutzer</li>
          <li><strong>LDAP-Integration:</strong> Verknüpfung mit Active Directory, Authentifizierungsdaten Dritter</li>
        </ul>
        Es ist keine DSFA-Dokumentation vorhanden oder im Repository verlinkt.
      </div>
      <div class="field-label">Risiko</div>
      <div class="field-value" style="margin-bottom: 10px;">
        Fehlendes DSFA bei Pflichtanwendbarkeit ist Verstoß gegen Art. 35 DSGVO. Bußgeld bis 10 Mio. EUR (Art. 83 Abs. 4). Die Aufsichtsbehörde kann die Verarbeitung einstellen lassen, bis DSFA vorliegt (Art. 58 Abs. 2 lit. f).
      </div>
      <div class="recommendation-box">
        <div class="rec-label">Empfehlung</div>
        <ul>
          <li>DSFA für jede identifizierte Hochrisikoverarbeitung durchführen: Beschreibung, Notwendigkeitsprüfung, Risikobewertung, Abhilfemaßnahmen, Restrisiko-Akzeptanz.</li>
          <li>Priorisierung: Fotobox von Minderjährigen zuerst (Art. 35 Abs. 3 lit. b eindeutig anwendbar).</li>
          <li>Verantwortlich: Schul-Träger (Verantwortlicher i.S.d. Art. 4 Nr. 7 DSGVO), nicht der Softwareanbieter.</li>
          <li>Vorlage: BayLDA-DSFA-Muster oder CNIL-PIA-Tool.</li>
          <li>Ergebnis der DSFA muss der Aufsichtsbehörde auf Anfrage vorgelegt werden können.</li>
        </ul>
      </div>
    </div>
  </div>

  <div class="finding">
    <div class="finding-header hoch">
      <span class="finding-id">F-007</span>
      <span class="finding-title">TOTP-Secret als Klartext in der Datenbank gespeichert</span>
      <span class="finding-badge badge-hoch">HOCH | OFFEN</span>
    </div>
    <div class="finding-body">
      <div class="finding-grid">
        <div>
          <div class="field-label">DSGVO-Artikel</div>
          <div class="field-value">
            <span class="article-ref">Art. 32 Abs. 1 lit. a</span>
            <span class="article-ref">Art. 5 Abs. 1 lit. f</span>
          </div>
        </div>
        <div>
          <div class="field-label">Fundstelle</div>
          <div class="field-value">
            <code>user/internal/model/User.java</code>, Feld <code>totp_secret</code> (Zeile 94)<br>
            <code>auth/internal/service/TotpService.java</code>, <code>generateSecret()</code><br>
            Datenbanktabelle <code>users</code>, Spalte <code>totp_secret VARCHAR(64)</code>
          </div>
        </div>
      </div>
      <div class="field-label">Beschreibung</div>
      <div class="field-value" style="margin-bottom: 12px;">
        Das TOTP-Secret (der kryptografische Schlüssel zur Generierung von Einmalpasswörtern) wird in der Spalte <code>users.totp_secret</code> als Base32-codierter Klartext gespeichert:
        <pre>// User.java Zeile 93-94
@Column(name = "totp_secret", length = 64)
private String totpSecret;  // Klartext-Base32: z. B. "JBSWY3DPEHPK3PXP..."</pre>
        Bei einem Datenbankdump oder SQL-Injection-Angriff sind alle TOTP-Secrets aller 2FA-aktivierten Nutzer sofort verwendbar. Ein Angreifer kann die Secrets in eine TOTP-App importieren und dauerhaft Einmalpasswörter generieren – auch wenn der Nutzer sein Passwort ändert. TOTP-Secrets sind langlebige Authentifizierungskredentiale, die dieselbe Schutzklasse wie Passwort-Hashes erfordern.
        <br><br>
        Die Recovery Codes werden korrekt per BCrypt gehasht (<code>TotpService.hashRecoveryCode()</code>), das Secret selbst jedoch nicht verschlüsselt.
      </div>
      <div class="field-label">Risiko</div>
      <div class="field-value" style="margin-bottom: 10px;">
        Datenbankzugriff (direkter SQL-Zugriff, Backup-Diebstahl, SQL-Injection) ermöglicht Übernahme aller 2FA-gesicherten Konten. Da 2FA als zweiter Faktor dient, werden damit beide Faktoren kompromittiert (Passwort-Hash angreifbar + 2FA-Secret bekannt). Kritisch für Lehrer- und Admin-Konten.
      </div>
      <div class="recommendation-box">
        <div class="rec-label">Empfehlung</div>
        <ul>
          <li>TOTP-Secret mit dem bereits vorhandenen <code>AesEncryptionService</code> (AES-256-GCM) verschlüsseln, bevor es in der Datenbank gespeichert wird.</li>
          <li>Speichern: <code>user.setTotpSecret(aesEncryptionService.encrypt(rawSecret))</code>.</li>
          <li>Lesen: <code>aesEncryptionService.decrypt(user.getTotpSecret())</code> vor Übergabe an TotpService.</li>
          <li>Migration: Bestehende Klartext-Secrets per Flyway-Migration (<code>V100__encrypt_totp_secrets.sql</code> + Java-Migrationscode) nachträglich verschlüsseln.</li>
          <li>Schlüsselrotation: Bei Rotation des ENCRYPTION_SECRET müssen alle verschlüsselten Secrets re-verschlüsselt werden (Admin-Job vorsehen).</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- MITTLERE RISIKEN -->
  <div class="section-title" id="mittel">Mittlere Risiken</div>

  <div class="finding">
    <div class="finding-header mittel">
      <span class="finding-id">F-009</span>
      <span class="finding-title">Benutzerverzeichnis gibt E-Mail und Telefon an alle authentifizierten Nutzer (Datensparsamkeit)</span>
      <span class="finding-badge badge-mittel">MITTEL | OFFEN</span>
    </div>
    <div class="finding-body">
      <div class="finding-grid">
        <div>
          <div class="field-label">DSGVO-Artikel</div>
          <div class="field-value">
            <span class="article-ref">Art. 5 Abs. 1 lit. c</span>
            <span class="article-ref">Art. 25 DSGVO</span>
          </div>
        </div>
        <div>
          <div class="field-label">Fundstelle</div>
          <div class="field-value"><code>user/internal/controller/UserController.java</code>, Endpoint <code>GET /api/v1/users/directory</code> Zeile 99–112</div>
        </div>
      </div>
      <div class="field-label">Beschreibung</div>
      <div class="field-value" style="margin-bottom: 12px;">
        Der Verzeichnis-Endpoint gibt für alle authentifizierten Nutzer (sofern das Modul <code>directoryAdminOnly</code> nicht aktiviert ist) die vollständigen <code>UserInfo</code>-Objekte zurück. Diese enthalten neben Name und Rolle auch E-Mail-Adresse und Telefonnummer. E-Mail-Adressen von Schülerinnen und Schülern und Eltern sollten nicht pauschal für alle Schulangehörigen einsehbar sein (Datensparsamkeitsprinzip Art. 5 Abs. 1 lit. c).
        <br><br>
        Zwar gibt es den Toggle <code>directoryAdminOnly</code>, aber dieser ist als optionales Feature implementiert und standardmässig deaktiviert. Privacy-by-Default (Art. 25) erfordert die datenschutzfreundlichste Einstellung als Standard.
      </div>
      <div class="recommendation-box">
        <div class="rec-label">Empfehlung</div>
        <ul>
          <li>E-Mail-Adresse und Telefonnummer aus der öffentlichen Verzeichnisansicht ausblenden oder nur auf ausdrücklichen Wunsch des Nutzers (<code>users.show_contact_in_directory</code>) anzeigen.</li>
          <li>Minimale Verzeichnisansicht: Vorname, Nachname, Rolle, Avatar, Schulbereich.</li>
          <li>Kontaktdaten nur direkt zwischen Personen mit berechtigtem Kontaktbedarf (z. B. via Nachrichtensystem) oder für TEACHER/SUPERADMIN.</li>
          <li><code>directoryAdminOnly</code>-Default auf <code>true</code> setzen (Privacy by Default, Art. 25 DSGVO).</li>
        </ul>
      </div>
    </div>
  </div>

  <div class="finding">
    <div class="finding-header mittel">
      <span class="finding-id">F-010</span>
      <span class="finding-title">Datenschutzerklärung enthält Platzhalter: Pflicht zur vollständigen Befüllung</span>
      <span class="finding-badge badge-mittel">MITTEL | OFFEN</span>
    </div>
    <div class="finding-body">
      <div class="finding-grid">
        <div>
          <div class="field-label">DSGVO-Artikel</div>
          <div class="field-value">
            <span class="article-ref">Art. 13 DSGVO</span>
            <span class="article-ref">Art. 14 DSGVO</span>
          </div>
        </div>
        <div>
          <div class="field-label">Fundstelle</div>
          <div class="field-value">
            <code>user/internal/controller/PrivacyController.java</code>, Methode <code>replacePlaceholders()</code> (Zeilen 166–179)<br>
            Datenbanktabelle <code>tenant_config</code>, Felder <code>privacy_policy_text</code>, <code>school_name</code>, <code>school_address</code>, <code>school_principal</code>
          </div>
        </div>
      </div>
      <div class="field-label">Beschreibung</div>
      <div class="field-value" style="margin-bottom: 12px;">
        Die <code>PrivacyController.replacePlaceholders()</code>-Methode ersetzt <code>{{SCHOOL_NAME}}</code>, <code>{{SCHOOL_ADDRESS}}</code>, <code>{{SCHOOL_PRINCIPAL}}</code>, <code>{{TECH_CONTACT_NAME}}</code> und <code>{{TECH_CONTACT_EMAIL}}</code> zur Laufzeit. Wenn diese Konfigurationswerte nicht gesetzt sind (Default: leerer String), enthält die ausgelieferte Datenschutzerklärung leere Felder oder Platzhalter-Text.

        Eine Datenschutzerklärung ohne gültige Kontaktdaten des Verantwortlichen und des Datenschutzbeauftragten ist eine unvollständige Datenschutzerklärung und verletzt die Informationspflicht aus Art. 13 DSGVO.
      </div>
      <div class="recommendation-box">
        <div class="rec-label">Empfehlung</div>
        <ul>
          <li>Beim Application-Start oder Admin-Konfiguration prüfen, ob alle Pflichtfelder der DSE ausgefüllt sind (Validierung).</li>
          <li>Wenn Felder fehlen: DSE-Endpunkt gibt HTTP 503 zurück mit Admin-Hinweis "Datenschutzerklärung noch nicht konfiguriert".</li>
          <li>Pflichtfelder: <code>school_name</code>, <code>school_address</code>, <code>school_principal</code>, <code>tech_contact_email</code>.</li>
          <li>Admin-UI: Deutliche Warnanzeige wenn Pflichtfelder der DSE nicht konfiguriert sind.</li>
        </ul>
      </div>
    </div>
  </div>

  <div class="finding">
    <div class="finding-header mittel">
      <span class="finding-id">F-011</span>
      <span class="finding-title">Jitsi-Integration: Kein Hinweis auf Server-Standort, potenzielle Drittlandübermittlung</span>
      <span class="finding-badge badge-mittel">MITTEL | OFFEN</span>
    </div>
    <div class="finding-body">
      <div class="finding-grid">
        <div>
          <div class="field-label">DSGVO-Artikel</div>
          <div class="field-value">
            <span class="article-ref">Art. 44–49 DSGVO</span>
            <span class="article-ref">Art. 13 Abs. 1 lit. f</span>
          </div>
        </div>
        <div>
          <div class="field-label">Fundstelle</div>
          <div class="field-value">
            Datenbanktabelle <code>tenant_config.jitsi_server_url</code><br>
            Tabellen <code>rooms.jitsi_room_name</code>, <code>calendar_events.jitsi_room_name</code> (V090)<br>
            DB-Toggle: <code>tenant_config.modules</code> JSONB Key <code>"jitsi"</code>
          </div>
        </div>
      </div>
      <div class="field-label">Beschreibung</div>
      <div class="field-value" style="margin-bottom: 12px;">
        Die Jitsi-Integration ermöglicht Video-Konferenzen direkt aus dem Intranet. Die Jitsi-Server-URL ist konfigurierbar (<code>jitsi_server_url</code>). Ist die URL auf einen US-amerikanischen oder sonstigen Nicht-EWR-Server gesetzt (z. B. <code>meet.jit.si</code>, betrieben in den USA), werden Video- und Audiodaten von Eltern, Lehrern und möglicherweise Minderjährigen in Drittländer übertragen. Hierfür ist ein angemessenes Schutzniveau (Art. 44–46 DSGVO) erforderlich, das bei US-Anbietern ohne aktuelle Standardvertragsklauseln (SCC) oder äquivalentem Schutzmechanismus nicht gegeben ist.
      </div>
      <div class="recommendation-box">
        <div class="rec-label">Empfehlung</div>
        <ul>
          <li>Admin-UI: Pflichthinweis bei Konfiguration der Jitsi-URL auf datenschutzrechtliche Anforderungen (Serversitz, AVV).</li>
          <li>Standard-Konfiguration sollte auf einen selbst-gehosteten Jitsi-Server oder EU-basierten Anbieter verweisen.</li>
          <li>VVT-Eintrag für Jitsi-Verarbeitung: Empfänger (Jitsi-Server-Betreiber), ggf. Drittlandübermittlung, Rechtsgrundlage.</li>
          <li>Bei Nutzung von <code>meet.jit.si</code> (8x8 Inc., USA): Standardvertragsklauseln (SCC) abschliessen, AVV prüfen.</li>
        </ul>
      </div>
    </div>
  </div>

  <div class="finding">
    <div class="finding-header mittel">
      <span class="finding-id">F-012</span>
      <span class="finding-title">Fotobox-Bilder ohne zeitbasierte Retention-Routine (Art. 5 Abs. 1 lit. e – Speicherbegrenzung)</span>
      <span class="finding-badge badge-mittel">MITTEL | OFFEN</span>
    </div>
    <div class="finding-body">
      <div class="finding-grid">
        <div>
          <div class="field-label">DSGVO-Artikel</div>
          <div class="field-value">
            <span class="article-ref">Art. 5 Abs. 1 lit. e</span>
            <span class="article-ref">Art. 17 DSGVO</span>
          </div>
        </div>
        <div>
          <div class="field-label">Fundstelle</div>
          <div class="field-value">
            <code>fotobox/internal/model/FotoboxImage.java</code> (Feld <code>createdAt</code> vorhanden)<br>
            Kein entsprechender Cleanup-Service in <code>fotobox/internal/service/</code>
          </div>
        </div>
      </div>
      <div class="field-label">Beschreibung</div>
      <div class="field-value" style="margin-bottom: 12px;">
        <code>FotoboxImage</code> enthält ein <code>createdAt</code>-Feld, aber es existiert kein periodischer Job, der Fotobox-Bilder nach Ablauf einer Aufbewahrungsfrist löscht. Das Feld wird nicht in <code>RetentionCleanupService</code> berücksichtigt. Fotos von Minderjährigen, die möglicherweise nur für ein einzelnes Schuljahr bestimmt waren, verbleiben dauerhaft in der Datenbank und in MinIO.
        <br><br>
        Art. 5 Abs. 1 lit. e DSGVO (Speicherbegrenzung) erfordert, dass Daten gelöscht werden, wenn der Zweck der Verarbeitung entfällt. Bei Fotos von Schülerinnen und Schülern entfällt der Zweck typischerweise mit dem Ende des Schuljahres oder dem Verlassen der Schule.
      </div>
      <div class="recommendation-box">
        <div class="rec-label">Empfehlung</div>
        <ul>
          <li>Admin-Konfiguration: <code>tenant_config.data_retention_days_fotobox</code> (z. B. 365 Tage) hinzufügen.</li>
          <li><code>RetentionCleanupService</code>: Periodischer Job löscht Fotobox-Bilder (und zugehörige MinIO-Objekte) nach Ablauf der konfigurierten Frist.</li>
          <li>Alternativ: Thread-basierte Retention (Thread wird gelöscht, Bilder kaskadierend).</li>
          <li>Bestehender <code>FotoboxDeletionListener</code> bei Nutzer-Löschung bereits vorhanden und korrekt – ergänzend zeitbasierte Retention hinzufügen.</li>
        </ul>
      </div>
    </div>
  </div>

  <div class="finding">
    <div class="finding-header mittel">
      <span class="finding-id">F-013</span>
      <span class="finding-title">Solr-Index: Volltext-Indizierung ohne gesonderte Lösch-Routine bei Dateilöschung</span>
      <span class="finding-badge badge-mittel">MITTEL | OFFEN</span>
    </div>
    <div class="finding-body">
      <div class="finding-grid">
        <div>
          <div class="field-label">DSGVO-Artikel</div>
          <div class="field-value">
            <span class="article-ref">Art. 17 DSGVO</span>
            <span class="article-ref">Art. 5 Abs. 1 lit. e</span>
          </div>
        </div>
        <div>
          <div class="field-label">Fundstelle</div>
          <div class="field-value">
            <code>search/internal/SearchDeletionListener.java</code> (nur für User-Löschung vorhanden)<br>
            <code>search/internal/service/SolrIndexingService.java</code>
          </div>
        </div>
      </div>
      <div class="field-label">Beschreibung</div>
      <div class="field-value" style="margin-bottom: 12px;">
        <code>SearchDeletionListener</code> hört auf <code>UserDeletionExecutedEvent</code> und löscht den User-Dokument aus dem Solr-Index. Dies ist korrekt für User-Löschungen. Es fehlt jedoch eine Löschroutine für gelöschte Dateien (Room-Files, Fotobox-Bilder): Wenn eine Datei aus MinIO und der Datenbank gelöscht wird, verbleibt der durch Tika extrahierte Dateiinhalt möglicherweise im Solr-Index. Personenbezogene Inhalte aus Dokumenten (z. B. Name in einem PDF-Dokument) bleiben damit suchbar, obwohl die Originaldatei gelöscht wurde.
      </div>
      <div class="recommendation-box">
        <div class="rec-label">Empfehlung</div>
        <ul>
          <li><code>FileDeletionEvent</code> publizieren wenn eine Datei gelöscht wird (Room-File, Fotobox-Bild).</li>
          <li><code>SearchDeletionListener</code> erweitern um Handler für <code>FileDeletionEvent</code>, der das Solr-Dokument mit der Datei-ID löscht.</li>
          <li>Alternativ: Periodischer Abgleich zwischen Datenbank und Solr-Index (Reconciliation-Job) täglich oder wöchentlich.</li>
        </ul>
      </div>
    </div>
  </div>

  <div class="finding">
    <div class="finding-header mittel">
      <span class="finding-id">F-014</span>
      <span class="finding-title">Neue Migration V099: sole_custody-Feld speichert hochsensibles Sorgerechts-Datum ohne gesonderte Schutzmaßnahmen</span>
      <span class="finding-badge badge-mittel">MITTEL | NEU</span>
    </div>
    <div class="finding-body">
      <div class="finding-grid">
        <div>
          <div class="field-label">DSGVO-Artikel</div>
          <div class="field-value">
            <span class="article-ref">Art. 9 Abs. 1 DSGVO</span>
            <span class="article-ref">Art. 6 Abs. 1 lit. c</span>
            <span class="article-ref">Art. 32 DSGVO</span>
          </div>
        </div>
        <div>
          <div class="field-label">Fundstelle</div>
          <div class="field-value">
            <code>backend/src/main/resources/db/migration/V099__family_sole_custody.sql</code><br>
            Felder: <code>families.sole_custody</code>, <code>families.sole_custody_approved</code><br>
            <code>tenant_config.sole_custody_enabled</code>, <code>tenant_config.require_family_switch_approval</code>
          </div>
        </div>
      </div>
      <div class="field-label">Beschreibung</div>
      <div class="field-value" style="margin-bottom: 12px;">
        Die Migration V099 fügt die Felder <code>sole_custody</code> (Alleinsorgerecht) und <code>sole_custody_approved</code> zur <code>families</code>-Tabelle hinzu. Alleinsorgerecht ist ein hochsensibles personenbezogenes Datum, das Rückschlüsse auf familiäre Verhältnisse, Trennungen und Schutzmaßnahmen erlaubt. Es fällt nicht direkt unter Art. 9 DSGVO (besondere Kategorie), hat aber analoge Schutzbedürftigkeit.
        <br><br>
        Spezifische Schutzmaßnahmen für dieses Feld (Zugriffsbeschränkung, Logging) sind nicht erkennbar implementiert. Zudem muss die Rechtsgrundlage für diese Verarbeitung explizit dokumentiert werden (Schulpflicht/rechtliche Verpflichtung oder berechtigtes Interesse der Schule).
      </div>
      <div class="recommendation-box">
        <div class="rec-label">Empfehlung</div>
        <ul>
          <li>Zugriffsbeschränkung: <code>sole_custody</code> und <code>sole_custody_approved</code> dürfen nur SUPERADMIN und SECTION_ADMIN einsehen (nicht TEACHER oder PARENT).</li>
          <li>Audit-Log: Jeder Zugriff auf diese Felder in <code>data_access_log</code> protokollieren.</li>
          <li>VVT: Separate Verarbeitungstätigkeit "Sorgerechts-Management" mit Rechtsgrundlage (Art. 6 Abs. 1 lit. c i.V.m. Schulrecht des jeweiligen Bundeslandes).</li>
          <li>Erforderlichkeitsprüfung: Ist die Speicherung im System notwendig oder kann sie durch organisatorische Maßnahmen ersetzt werden?</li>
          <li>Löschfrist: Sorgerechtsangaben löschen wenn Kind die Schule verlässt.</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- NIEDRIGE RISIKEN / HINWEISE -->
  <div class="section-title" id="niedrig">Niedrige Risiken und Hinweise</div>

  <div class="finding">
    <div class="finding-header niedrig">
      <span class="finding-id">H-001</span>
      <span class="finding-title">AES-Verschlüsselung: Fallback auf JWT-Secret wenn ENCRYPTION_SECRET nicht gesetzt</span>
      <span class="finding-badge badge-niedrig">HINWEIS | OFFEN</span>
    </div>
    <div class="finding-body">
      <div class="finding-grid">
        <div>
          <div class="field-label">DSGVO-Artikel</div>
          <div class="field-value">
            <span class="article-ref">Art. 32 Abs. 1 lit. a</span>
          </div>
        </div>
        <div>
          <div class="field-label">Fundstelle</div>
          <div class="field-value"><code>shared/util/AesEncryptionService.java</code> Zeilen 33–41</div>
        </div>
      </div>
      <div class="field-label">Beschreibung</div>
      <div class="field-value" style="margin-bottom: 12px;">
        Der Fix (F-006) hat den AES-Schlüssel vom JWT-Secret entkoppelt. Jedoch: Wenn <code>ENCRYPTION_SECRET</code> nicht in der Umgebung gesetzt ist, fällt der <code>AesEncryptionService</code> auf das JWT-Secret zurück und loggt nur einen Warn. In produktiven Deployments ohne explizites <code>ENCRYPTION_SECRET</code> besteht das Key-Coupling-Problem weiterhin. <code>SecretValidationConfig</code> gibt einen Warn aus, verhindert aber den Start nicht (ausser im prod-Profil).
      </div>
      <div class="recommendation-box">
        <div class="rec-label">Empfehlung</div>
        <ul>
          <li>Deployment-Dokumentation explizit: <code>ENCRYPTION_SECRET</code> ist Pflicht.</li>
          <li>Docker-Compose-Beispiel: <code>ENCRYPTION_SECRET</code> in alle Compose-Dateien eintragen (mit Hinweis auf separate Generierung).</li>
          <li>Optional: Startup-Prüfung verschärfen – bei fehlendem ENCRYPTION_SECRET immer Abbruch, nicht nur im prod-Profil.</li>
        </ul>
      </div>
    </div>
  </div>

  <div class="finding">
    <div class="finding-header niedrig">
      <span class="finding-id">H-002</span>
      <span class="finding-title">Neue message_attachments-Tabelle (V098): Kein Hinweis auf Retention für Chat-Anhänge</span>
      <span class="finding-badge badge-niedrig">HINWEIS | NEU</span>
    </div>
    <div class="finding-body">
      <div class="finding-grid">
        <div>
          <div class="field-label">DSGVO-Artikel</div>
          <div class="field-value">
            <span class="article-ref">Art. 5 Abs. 1 lit. e</span>
          </div>
        </div>
        <div>
          <div class="field-label">Fundstelle</div>
          <div class="field-value"><code>backend/src/main/resources/db/migration/V098__message_attachments.sql</code></div>
        </div>
      </div>
      <div class="field-label">Beschreibung</div>
      <div class="field-value" style="margin-bottom: 12px;">
        V098 fügt die Tabelle <code>message_attachments</code> hinzu (Datei-Anhänge und Datei-Links in Nachrichten). Diese Tabelle hat ein <code>created_at</code>-Feld, aber es ist kein Retention-Cleanup für diese Anhänge im <code>RetentionCleanupService</code> vorgesehen. Chat-Bilder haben bereits einen 90-Tage-Cleanup (<code>message_images</code>), aber Datei-Anhänge (<code>attachment_type = 'FILE'</code>) nicht.
      </div>
      <div class="recommendation-box">
        <div class="rec-label">Empfehlung</div>
        <ul>
          <li>Retention-Policy für <code>message_attachments</code> definieren (z. B. analog zu <code>message_images</code>: 90 Tage).</li>
          <li><code>RetentionCleanupService</code> um Cleanup von alten <code>message_attachments</code> erweitern.</li>
          <li>Klären: Sollen Datei-Links (<code>attachment_type = 'FILE_LINK'</code>) bei Löschung des Ziel-Raum-Files automatisch bereinigt werden (Cascade)?</li>
        </ul>
      </div>
    </div>
  </div>

  <div class="finding">
    <div class="finding-header niedrig">
      <span class="finding-id">H-003</span>
      <span class="finding-title">Datenbankpasswörter als Default-Werte in application.yml (Entwicklungsrisiko)</span>
      <span class="finding-badge badge-niedrig">HINWEIS | OFFEN</span>
    </div>
    <div class="finding-body">
      <div class="finding-grid">
        <div>
          <div class="field-label">DSGVO-Artikel</div>
          <div class="field-value">
            <span class="article-ref">Art. 32 DSGVO</span>
          </div>
        </div>
        <div>
          <div class="field-label">Fundstelle</div>
          <div class="field-value"><code>backend/src/main/resources/application.yml</code> Zeilen 8, 30, 97–98</div>
        </div>
      </div>
      <div class="field-label">Beschreibung</div>
      <div class="field-value" style="margin-bottom: 12px;">
        <code>application.yml</code> enthält explizite Default-Werte für Datenbankpasswörter: <code>DB_PASSWORD:changeme</code>, <code>REDIS_PASSWORD:changeme</code>, <code>MINIO_ACCESS_KEY:minioadmin</code>, <code>MINIO_SECRET_KEY:minioadmin</code>. <code>SecretValidationConfig</code> warnt bei diesen Defaults, bricht aber nicht ab (ausser im prod-Profil). Dies ist ein akzeptiertes Risiko für Entwicklungsumgebungen, aber ein Hinweis für Produktions-Deployments ohne korrekte Konfiguration.
      </div>
      <div class="recommendation-box">
        <div class="rec-label">Empfehlung</div>
        <ul>
          <li>Deployment-Checkliste für Schuladmins erstellen: Alle Passwörter vor Produktivbetrieb zwingend ändern.</li>
          <li><code>SecretValidationConfig</code>: Startup-Abbruch auch ausserhalb prod-Profil wenn Default-Passwörter erkannt werden (oder zumindest ein auffälliges Banner im Startlog).</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- BEHOBENE FINDINGS – VOLLSTÄNDIGE DOKUMENTATION -->
  <div class="section-title">Behobene Findings (vollständige Dokumentation)</div>

  <div class="finding">
    <div class="finding-header behoben">
      <span class="finding-id">F-001</span>
      <span class="finding-title">JWT-Token-Speicherung – localStorage durch sessionStorage + Memory ersetzt</span>
      <span class="finding-badge badge-behoben">BEHOBEN</span>
    </div>
    <div class="finding-body">
      <div class="finding-grid">
        <div>
          <div class="field-label">DSGVO-Artikel</div>
          <div class="field-value"><span class="article-ref">Art. 32 DSGVO</span></div>
        </div>
        <div>
          <div class="field-label">Commit</div>
          <div class="field-value">7798f05</div>
        </div>
      </div>
      <div class="fix-box">
        <div class="fix-label">Umgesetzte Massnahme</div>
        <p>Access-Token nur noch im Pinia-<code>ref()</code> (Memory). Refresh-Token in <code>sessionStorage</code> (nicht persistent, kein Tab-übergreifender Zugriff). Logout leert <code>sessionStorage</code> vollständig. Service-Worker-Cache wird bei Logout geleert. Verbleibendes Restrisiko bei XSS im aktiven Tab dokumentiert als F-001-REST.</p>
      </div>
    </div>
  </div>

  <div class="finding">
    <div class="finding-header behoben">
      <span class="finding-id">F-002</span>
      <span class="finding-title">Error-Reporting – Nur Pathname, kein userAgent, keine vollständige URL</span>
      <span class="finding-badge badge-behoben">BEHOBEN</span>
    </div>
    <div class="finding-body">
      <div class="finding-grid">
        <div>
          <div class="field-label">DSGVO-Artikel</div>
          <div class="field-value"><span class="article-ref">Art. 5 Abs. 1 lit. c</span> <span class="article-ref">Art. 25</span></div>
        </div>
        <div>
          <div class="field-label">Commit</div>
          <div class="field-value">7798f05</div>
        </div>
      </div>
      <div class="fix-box">
        <div class="fix-label">Umgesetzte Massnahme</div>
        <p><code>useErrorReporting.ts</code> sendet nur <code>window.location.pathname</code> (ohne Query-Parameter, Fragment oder userAgent). PII-Leck durch URL-Parameter und Geräte-Fingerabdruck eliminiert. Kommentar in Code dokumentiert die Designentscheidung explizit.</p>
      </div>
    </div>
  </div>

  <div class="finding">
    <div class="finding-header behoben">
      <span class="finding-id">F-004</span>
      <span class="finding-title">STUDENT-Selbst-Consent blockiert (HTTP 403)</span>
      <span class="finding-badge badge-behoben">BEHOBEN</span>
    </div>
    <div class="finding-body">
      <div class="finding-grid">
        <div>
          <div class="field-label">DSGVO-Artikel</div>
          <div class="field-value"><span class="article-ref">Art. 8 DSGVO</span></div>
        </div>
        <div>
          <div class="field-label">Commit</div>
          <div class="field-value">7798f05</div>
        </div>
      </div>
      <div class="fix-box">
        <div class="fix-label">Umgesetzte Massnahme</div>
        <p><code>PrivacyController.updateConsent()</code> prüft <code>ROLE_STUDENT</code> und gibt HTTP 403 zurück wenn ein Schüler seinen eigenen Consent ändern möchte. Verbleibende Schwachstelle (fehlendes Family-Membership-Check für Drittparteien) dokumentiert als F-004-REST.</p>
      </div>
    </div>
  </div>

  <div class="finding">
    <div class="finding-header behoben">
      <span class="finding-id">F-006</span>
      <span class="finding-title">AES-Encryption-Key vom JWT-Secret entkoppelt (dediziertes ENCRYPTION_SECRET)</span>
      <span class="finding-badge badge-behoben">BEHOBEN</span>
    </div>
    <div class="finding-body">
      <div class="finding-grid">
        <div>
          <div class="field-label">DSGVO-Artikel</div>
          <div class="field-value"><span class="article-ref">Art. 32 DSGVO</span></div>
        </div>
        <div>
          <div class="field-label">Commit</div>
          <div class="field-value">7798f05</div>
        </div>
      </div>
      <div class="fix-box">
        <div class="fix-label">Umgesetzte Massnahme</div>
        <p><code>AesEncryptionService</code> nutzt <code>${monteweb.encryption.secret}</code> (mind. 32 Zeichen) als primäre Schlüsselquelle. Fallback auf JWT-Secret mit explizitem Warn-Log. <code>SecretValidationConfig</code> prüft ENCRYPTION_SECRET auf Mindestlänge 64 Zeichen und Differenz zum JWT_SECRET. JWT-Secret-Rotation zerstört nicht mehr automatisch alle AES-verschlüsselten Werte in der DB.</p>
      </div>
    </div>
  </div>

  <div class="finding">
    <div class="finding-header behoben">
      <span class="finding-id">F-008</span>
      <span class="finding-title">RetentionCleanupService löscht Notifications und Error-Reports gemäss konfigurierten Fristen</span>
      <span class="finding-badge badge-behoben">BEHOBEN</span>
    </div>
    <div class="finding-body">
      <div class="finding-grid">
        <div>
          <div class="field-label">DSGVO-Artikel</div>
          <div class="field-value"><span class="article-ref">Art. 5 Abs. 1 lit. e</span></div>
        </div>
        <div>
          <div class="field-label">Commit</div>
          <div class="field-value">7798f05</div>
        </div>
      </div>
      <div class="fix-box">
        <div class="fix-label">Umgesetzte Massnahme</div>
        <p><code>RetentionCleanupService</code> (täglicher Cron 04:30 Uhr) löscht jetzt: (1) Alte Notifications via <code>notificationModuleApi.deleteOlderThan()</code> nach <code>dataRetentionDaysNotifications</code> (Default: 90 Tage), (2) Error-Reports nach Status-abhängiger Frist (RESOLVED/IGNORED: 90 Tage, NEW/REPORTED: 365 Tage). Audit-Log-Cleanup war bereits vorhanden und bleibt erhalten.</p>
      </div>
    </div>
  </div>

  <!-- POSITIVE BEFUNDE -->
  <div class="section-title" id="positiv">Positive Befunde – Bereits gut umgesetzt</div>

  <div class="positive-box">
    <h4>Authentifizierung und Sitzungssicherheit</h4>
    <ul>
      <li>BCrypt-Passworthashing für lokale Authentifizierung</li>
      <li>JWT-Access-Token (15 Minuten) + Refresh-Token (7 Tage) mit Revocation via Redis</li>
      <li>Refresh-Token-Reuse-Detection: Alle Sessions werden bei Missbrauchserkennung gesperrt</li>
      <li>2FA TOTP (RFC 6238) mit Redis Anti-Replay (90-Sekunden-TTL), Recovery Codes BCrypt-gehasht</li>
      <li>Rate-Limiting für Auth-Endpunkte (Login: 10/min, Register: 5/min, 2FA: 5/min)</li>
      <li><code>SecretValidationConfig</code>: Startup-Prüfung aller kritischen Secrets mit Mindestlänge 64 Zeichen</li>
      <li>LDAP-Bind-Passwort AES-GCM-verschlüsselt in DB (ENC()-Präfix)</li>
      <li>TOTP-Replay-Schutz via Redis-Key <code>totp_used:{secretHash}:{timeStep}</code></li>
    </ul>
  </div>

  <div class="positive-box">
    <h4>DSGVO-Betroffenenrechte (Art. 15–20)</h4>
    <ul>
      <li>Daten-Export (Art. 15/20): <code>GET /api/v1/users/me/data-export</code> implementiert</li>
      <li>Account-Löschung (Art. 17): <code>DELETE /api/v1/users/me</code> mit 14-Tage Grace-Period (<code>deletion_requested_at</code>, <code>scheduled_deletion_at</code>)</li>
      <li>Consent-System: <code>consent_records</code>-Tabelle mit PHOTO_CONSENT/CHAT_CONSENT, Widerrufsmöglichkeit</li>
      <li>Terms-Acceptance: Versionierte AGB-Annahme (<code>terms_acceptances</code>), Sperre bei Ablehnung</li>
      <li>Audit-Log: <code>data_access_log</code> protokolliert alle Art.-15-Datenzugriffe</li>
      <li>Privacy-Policy-Endpoint: <code>GET /api/v1/privacy/policy</code> öffentlich zugänglich</li>
    </ul>
  </div>

  <div class="positive-box">
    <h4>Sicherheitsheader und Transport-Sicherheit</h4>
    <ul>
      <li>HSTS (<code>max-age=31536000; includeSubDomains</code>)</li>
      <li>Content-Security-Policy: <code>default-src 'self'; script-src 'self'; frame-ancestors 'none'</code></li>
      <li>X-Frame-Options: DENY</li>
      <li>Referrer-Policy: <code>strict-origin-when-cross-origin</code></li>
      <li>Permissions-Policy: camera/microphone/geolocation gesperrt</li>
      <li>Actuator-Endpunkte: nur <code>/actuator/health</code> öffentlich, Prometheus nur für SUPERADMIN</li>
    </ul>
  </div>

  <div class="positive-box">
    <h4>Datenschutz by Design und Datensparsamkeit</h4>
    <ul>
      <li>WOPI-Token-Cleanup: <code>WopiTokenService</code> löscht abgelaufene Tokens alle 5 Minuten (<code>@Scheduled</code>)</li>
      <li>Service-Worker-Cache bei Logout vollständig geleert (verhindert Datenleck auf gemeinsam genutzten Geräten)</li>
      <li>ClamAV-Virenscanner für Datei-Uploads (fail-open=false: Uploads geblockt wenn ClamAV nicht erreichbar)</li>
      <li>RBAC mit <code>@EnableMethodSecurity</code> und <code>@PreAuthorize</code></li>
      <li>Audience-Sichtbarkeit für Ordner und Fotobox-Threads (ALL/PARENTS_ONLY/STUDENTS_ONLY)</li>
      <li>FotoboxDeletionListener: Nutzer-Daten aus Fotobox bei Account-Löschung bereinigt</li>
      <li>SearchDeletionListener: Solr-Index bei Nutzer-Löschung bereinigt</li>
      <li>Retention-Cleanup für Notifications, Audit-Log und Error-Reports</li>
      <li>LDAP-Injection-Escaping (RFC 4515)</li>
      <li>Verschlüsselung sensibler Config-Werte in DB mit AES-256-GCM</li>
    </ul>
  </div>

  <!-- MASSNAHMENPLAN -->
  <div class="section-title" id="massnahmen">Priorisierter Maßnahmenplan</div>

  <table class="action-table">
    <thead>
      <tr>
        <th>ID</th>
        <th>Massnahme</th>
        <th>Priorität</th>
        <th>Aufwand</th>
        <th>DSGVO-Artikel</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><strong>F-003</strong></td>
        <td>Verzeichnis der Verarbeitungstätigkeiten (VVT) erstellen und pflegen</td>
        <td class="priority-k">SOFORT</td>
        <td>Mittel (organisatorisch)</td>
        <td>Art. 30</td>
        <td>OFFEN</td>
      </tr>
      <tr>
        <td><strong>F-007</strong></td>
        <td>TOTP-Secrets mit AES-256-GCM verschlüsseln, Migration bestehender Secrets</td>
        <td class="priority-h">HOCH</td>
        <td>Mittel (Backend + Migration)</td>
        <td>Art. 32</td>
        <td>OFFEN</td>
      </tr>
      <tr>
        <td><strong>F-004-REST</strong></td>
        <td>Family-Membership-Prüfung im Consent-Controller</td>
        <td class="priority-h">HOCH</td>
        <td>Gering (Backend)</td>
        <td>Art. 8</td>
        <td>OFFEN</td>
      </tr>
      <tr>
        <td><strong>F-001-REST</strong></td>
        <td>Refresh-Token als HttpOnly-Cookie (finale XSS-Absicherung)</td>
        <td class="priority-h">HOCH</td>
        <td>Hoch (Frontend + Backend)</td>
        <td>Art. 32</td>
        <td>OFFEN</td>
      </tr>
      <tr>
        <td><strong>F-005</strong></td>
        <td>DSFA für Kinderdaten/Fotobox/Kommunikation durchführen</td>
        <td class="priority-h">HOCH</td>
        <td>Hoch (organisatorisch)</td>
        <td>Art. 35</td>
        <td>OFFEN</td>
      </tr>
      <tr>
        <td><strong>F-014</strong></td>
        <td>Zugriffsbeschränkung und Audit-Logging für sole_custody-Felder</td>
        <td class="priority-m">MITTEL</td>
        <td>Gering (Backend)</td>
        <td>Art. 9, Art. 32</td>
        <td>OFFEN</td>
      </tr>
      <tr>
        <td><strong>F-009</strong></td>
        <td>Benutzerverzeichnis: E-Mail/Telefon nicht pauschal sichtbar (Privacy by Default)</td>
        <td class="priority-m">MITTEL</td>
        <td>Gering (Backend + Frontend)</td>
        <td>Art. 5 lit. c, Art. 25</td>
        <td>OFFEN</td>
      </tr>
      <tr>
        <td><strong>F-010</strong></td>
        <td>Validierung Pflichtfelder Datenschutzerklärung (keine Platzhalter in Produktion)</td>
        <td class="priority-m">MITTEL</td>
        <td>Gering (Backend)</td>
        <td>Art. 13</td>
        <td>OFFEN</td>
      </tr>
      <tr>
        <td><strong>F-012</strong></td>
        <td>Retention-Routine für Fotobox-Bilder implementieren</td>
        <td class="priority-m">MITTEL</td>
        <td>Gering (Backend)</td>
        <td>Art. 5 lit. e, Art. 17</td>
        <td>OFFEN</td>
      </tr>
      <tr>
        <td><strong>F-013</strong></td>
        <td>Solr-Index-Cleanup bei Dateilöschung implementieren</td>
        <td class="priority-m">MITTEL</td>
        <td>Mittel (Backend)</td>
        <td>Art. 17</td>
        <td>OFFEN</td>
      </tr>
      <tr>
        <td><strong>F-011</strong></td>
        <td>Jitsi-Server-URL: Admin-Hinweis auf Datenschutzpflichten, EWR-Standard</td>
        <td class="priority-m">MITTEL</td>
        <td>Gering (Frontend + Docs)</td>
        <td>Art. 44–49</td>
        <td>OFFEN</td>
      </tr>
      <tr>
        <td><strong>H-002</strong></td>
        <td>Retention für message_attachments-Tabelle (V098) definieren</td>
        <td class="priority-b">NIEDRIG</td>
        <td>Gering (Backend)</td>
        <td>Art. 5 lit. e</td>
        <td>OFFEN</td>
      </tr>
      <tr>
        <td><strong>H-001</strong></td>
        <td>ENCRYPTION_SECRET als absolutes Pflichtfeld dokumentieren und durchsetzen</td>
        <td class="priority-b">NIEDRIG</td>
        <td>Gering (Docs + Config)</td>
        <td>Art. 32</td>
        <td>OFFEN</td>
      </tr>
      <tr>
        <td><strong>F-001</strong></td>
        <td>localStorage durch sessionStorage + Memory ersetzt</td>
        <td class="priority-b">BEHOBEN</td>
        <td>–</td>
        <td>Art. 32</td>
        <td style="color: var(--color-behoben); font-weight: 700;">BEHOBEN</td>
      </tr>
      <tr>
        <td><strong>F-002</strong></td>
        <td>Error-Reporting sendet nur Pathname</td>
        <td class="priority-b">BEHOBEN</td>
        <td>–</td>
        <td>Art. 5 lit. c</td>
        <td style="color: var(--color-behoben); font-weight: 700;">BEHOBEN</td>
      </tr>
      <tr>
        <td><strong>F-004</strong></td>
        <td>STUDENT-Selbst-Consent blockiert</td>
        <td class="priority-b">BEHOBEN</td>
        <td>–</td>
        <td>Art. 8</td>
        <td style="color: var(--color-behoben); font-weight: 700;">BEHOBEN</td>
      </tr>
      <tr>
        <td><strong>F-006</strong></td>
        <td>AES-Key vom JWT-Secret entkoppelt</td>
        <td class="priority-b">BEHOBEN</td>
        <td>–</td>
        <td>Art. 32</td>
        <td style="color: var(--color-behoben); font-weight: 700;">BEHOBEN</td>
      </tr>
      <tr>
        <td><strong>F-008</strong></td>
        <td>Retention-Cleanup für Notifications und Error-Reports funktional</td>
        <td class="priority-b">BEHOBEN</td>
        <td>–</td>
        <td>Art. 5 lit. e</td>
        <td style="color: var(--color-behoben); font-weight: 700;">BEHOBEN</td>
      </tr>
    </tbody>
  </table>

  <!-- DOKUMENTATIONSPFLICHTEN -->
  <div class="section-title" id="dokumentation">Erforderliche Dokumentation</div>

  <div class="doc-grid">
    <div class="doc-card">
      <h4>Verzeichnis der Verarbeitungstätigkeiten (VVT)</h4>
      <p>Art. 30 DSGVO. Pflicht für die Schule als Verantwortliche. Mindestens 12 Verarbeitungstätigkeiten zu dokumentieren. Sofortiger Handlungsbedarf (Finding F-003).</p>
    </div>
    <div class="doc-card">
      <h4>Datenschutz-Folgenabschätzung (DSFA)</h4>
      <p>Art. 35 DSGVO. Erforderlich für Fotobox (Minderjährige), Messaging (Minderjährige), Familienverwaltung (Sorgerechtsangaben). Finding F-005.</p>
    </div>
    <div class="doc-card">
      <h4>Auftragsverarbeitungsverträge (AVV)</h4>
      <p>Art. 28 DSGVO. Erforderlich mit: Hosting-Anbieter (Server), Backup-Anbieter (wenn S3-Remote), Jitsi-Anbieter (wenn externer Server), E-Mail-Provider (SMTP).</p>
    </div>
    <div class="doc-card">
      <h4>Technische und organisatorische Massnahmen (TOMs)</h4>
      <p>Art. 32 DSGVO. Dokumentation aller implementierten Sicherheitsmassnahmen (Verschlüsselung, Zugriffskontrollen, Backup, Monitoring). Bestandteil des VVT.</p>
    </div>
    <div class="doc-card">
      <h4>Datenschutzerklärung (vollständig ausgefüllt)</h4>
      <p>Art. 13/14 DSGVO. Alle Platzhalter müssen durch echte Schuldaten ersetzt werden. Validierung im System empfohlen (Finding F-010).</p>
    </div>
    <div class="doc-card">
      <h4>Data-Breach-Response-Plan</h4>
      <p>Art. 33/34 DSGVO. Verfahren zur 72-Stunden-Meldung bei Datenpannen. Kontakt zur Aufsichtsbehörde dokumentieren. Entscheidungsbaum: wann ist eine Panne meldepflichtig?</p>
    </div>
  </div>

  <div style="margin-top: 28px; background: #fff; border-radius: 10px; padding: 20px 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.06);">
    <div class="field-label" style="margin-bottom: 8px;">Prüfungs-Checkliste (Selbstverifikation)</div>
    <div style="font-size: 0.88rem; color: #555;">
      <p>Alle Art. 5-Grundsätze geprüft: Ja (Rechtmässigkeit, Zweckbindung, Datensparsamkeit, Richtigkeit, Speicherbegrenzung, Integrität/Vertraulichkeit)</p>
      <p>Betroffenenrechte Art. 15–22 geprüft: Ja (Export, Löschung, Berichtigung, Einschränkung, Datenübertragbarkeit vorhanden; Widerspruchsrecht nicht explizit implementiert)</p>
      <p>Datenbankfelder auf Art. 9-Daten geprüft: Ja (sole_custody hochsensibel, kein explizites Art. 9-Feld, aber analoge Schutzbedürftigkeit; F-014)</p>
      <p>Logging auf PII geprüft: Ja (GlobalExceptionHandler loggt keine PII; Error-Reporting sendet nur Pathname; LDAP-Passwort nicht in API-Antworten)</p>
      <p>Drittanbieter-Datenflüsse geprüft: Ja (Jitsi: F-011; Solr: intern; MinIO: intern; ClamAV: intern)</p>
      <p>Lösch- und Retention-Konzept bewertet: Teilweise (Notifications/Audit-Log/Error-Reports: OK; Fotobox: F-012; message_attachments: H-002; Solr: F-013)</p>
      <p>Sicherheitsmassnahmen Art. 32 bewertet: Ja (BCrypt, AES-GCM, TLS/HSTS, CSP, Rate-Limiting, ClamAV, JWT-Revocation, SecretValidation)</p>
    </div>
  </div>

</div>

<footer>
  DSGVO-Prüfbericht MonteWeb | Nachaudit 01.03.2026 | Datenschutzbeauftragter (KI-gestützt) | Grundlage: DSGVO (EU) 2016/679 | 5 Findings behoben, 1 kritisch + 4 hoch + 6 mittel + 3 Hinweise offen
</footer>

</body>
</html>
