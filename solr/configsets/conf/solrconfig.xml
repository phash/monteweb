<?xml version="1.0" encoding="UTF-8" ?>
<config>
  <luceneMatchVersion>9.11</luceneMatchVersion>

  <dataDir>${solr.data.dir:}</dataDir>

  <directoryFactory name="DirectoryFactory" class="${solr.directoryFactory:solr.NRTCachingDirectoryFactory}" />

  <schemaFactory class="ClassicIndexSchemaFactory" />

  <indexConfig>
    <ramBufferSizeMB>100</ramBufferSizeMB>
    <maxBufferedDocs>1000</maxBufferedDocs>
  </indexConfig>

  <updateHandler class="solr.DirectUpdateHandler2">
    <autoCommit>
      <maxTime>${solr.autoCommit.maxTime:5000}</maxTime>
      <openSearcher>false</openSearcher>
    </autoCommit>
    <autoSoftCommit>
      <maxTime>${solr.autoSoftCommit.maxTime:1000}</maxTime>
    </autoSoftCommit>
  </updateHandler>

  <!-- Search handler with highlighting -->
  <requestHandler name="/select" class="solr.SearchHandler">
    <lst name="defaults">
      <str name="echoParams">explicit</str>
      <str name="wt">json</str>
      <int name="rows">20</int>
      <str name="df">text</str>
      <str name="defType">edismax</str>
      <str name="qf">title^3 content^2 file_content^1.5 author_name^1 room_name^1</str>
      <!-- Highlighting -->
      <str name="hl">true</str>
      <str name="hl.fl">title,content,file_content</str>
      <int name="hl.snippets">2</int>
      <int name="hl.fragsize">150</int>
      <str name="hl.simple.pre">&lt;mark&gt;</str>
      <str name="hl.simple.post">&lt;/mark&gt;</str>
    </lst>
  </requestHandler>

  <!-- ExtractingRequestHandler for Tika-based file content extraction (PDF, DOCX, etc.) -->
  <requestHandler name="/update/extract" class="solr.extraction.ExtractingRequestHandler" startup="lazy">
    <lst name="defaults">
      <str name="fmap.content">file_content</str>
      <str name="lowernames">true</str>
      <str name="uprefix">ignored_</str>
    </lst>
  </requestHandler>

  <!-- Ping handler -->
  <requestHandler name="/admin/ping" class="solr.PingRequestHandler">
    <lst name="invariants">
      <str name="q">solrpingquery</str>
    </lst>
    <lst name="defaults">
      <str name="echoParams">all</str>
    </lst>
  </requestHandler>

  <query>
    <maxBooleanClauses>${solr.max.booleanClauses:1024}</maxBooleanClauses>
    <filterCache class="solr.CaffeineCache" size="512" initialSize="64" autowarmCount="32" />
    <queryResultCache class="solr.CaffeineCache" size="512" initialSize="64" autowarmCount="32" />
    <documentCache class="solr.CaffeineCache" size="512" initialSize="64" autowarmCount="0" />
  </query>

</config>
